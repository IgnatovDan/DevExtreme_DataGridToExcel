<!DOCTYPE html>
<html>
<head>
    <title>DevExtreme DataGrid to Excel / exceljs</title>

    <link rel="stylesheet" type="text/css" href="https://cdn3.devexpress.com/jslib/18.2.3/css/dx.common.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn3.devexpress.com/jslib/18.2.3/css/dx.light.css" />
    <script type="text/javascript" src="https://cdn3.devexpress.com/jslib/18.2.3/js/dx.all.debug.js"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/1.6.3/exceljs.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>

</head>
<body>
    <script>
        async function ExportToExcel(dxDataGrid, saveMode) {
            const workbook = new ExcelJS.Workbook();
            const worksheet = workbook.addWorksheet('sheet 42');
            const columns = dxDataGrid.getVisibleColumns();
            const headerRow = worksheet.addRow();
            for(let i = 0; i < columns.length; i++) {
                const cell = headerRow.getCell(i + 1);
                cell.value = columns[i].caption;
                cell.font = cell.font || {};
                cell.font.bold = true;
            }

            const sourceItems = await dxDataGrid.getController("data").loadAll();

            for(let i = 0; i < sourceItems.length; i++) {
                const dataRow = worksheet.addRow();
                for(let j = 0; j < sourceItems[i].values.length; j++) {
                    const cell = dataRow.getCell(j + 1);
                    cell.value = sourceItems[i].values[j];
                }
            }

            worksheet.getCell('A10').value = 'exceljs';
            worksheet.getCell('B10').value = saveMode;

            if(saveMode === 'FileSaver') {
                workbook.xlsx.writeBuffer()
                .then(function(buffer) {
                    saveAs(new Blob([buffer], { type: 'application/octet-stream' }), 'test.xlsx');
                });
            }
            else {
                workbook.xlsx.writeBuffer()
                .then(function(buffer) {
                    //const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                    const blob = new Blob([buffer], { type: 'application/octet-stream' });
                    const url = window.URL.createObjectURL(blob);
                    const anchor = document.createElement('a');
                    anchor.href = url;
                    anchor.download = 'test.xlsx';
                    anchor.click();
                    window.URL.revokeObjectURL(url);
                });
            }
        }
    </script>

    <div class="ExportToExcel_FileSaver"></div>
    <div class="ExportToExcel_AnchorClick"></div>
    <div class="jsdxDataGrid"></div>
    <script>
        (function() {
            const dxDataGrid = new DevExpress.ui.dxDataGrid(document.querySelector('.jsdxDataGrid'), {
                columns: [
                    { dataField: "f1", width: 100 },
                    { dataField: "f2", width: 50 },
                    { dataField: "f3", width: 100 },
                    { dataField: "f4", width: 200 },
                ],
                showColumnHeaders: true,
                dataSource: [
                    {f1: 11, f2: 12, f3: 13, f4: 14},
                    {f1: 21, f2: 22, f3: 23, f4: 24},
                ],
            });

            new DevExpress.ui.dxButton(document.querySelector('.ExportToExcel_FileSaver'), {
                text: 'ExportToExcel_FileSaver',
                onClick: e => ExportToExcel(dxDataGrid, 'FileSaver')
            });
            new DevExpress.ui.dxButton(document.querySelector('.ExportToExcel_AnchorClick'), {
                text: 'ExportToExcel_AnchorClick',
                onClick: e => ExportToExcel(dxDataGrid, 'Anchor')
            });
        })();
    </script>

</body>
</html> 